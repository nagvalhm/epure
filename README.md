<p align="center">
<svg width="182" height="35" viewBox="0 0 182 35" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="182" height="35" fill="url(#pattern0)"/>
<defs>
<pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_331_118" transform="scale(0.00243427 0.0126582)"/>
</pattern>
<image id="image0_331_118" width="411" height="79" xlink:href="data:image/png;base64,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"/>
</defs>
</svg>

![svgviewer-output (1)](https://github.com/nagvalhm/epure/assets/20476975/9c5c52c9-a59e-4e48-8cd1-d79d1a8d78fe)
</p>

<p align="center">
    <em>The purest architecture, magic debugger, lightweight syntax</em>
</p>

---

**Documentation**: <a href="https://epurelib.github.io/docs/" target="_blank">https://epurelib.github.io/docs/</a>

**Source Code**: <a href="https://github.com/nagvalhm/epure" target="_blank">https://github.com/nagvalhm/epure</a>

---

Epure is python agnostic ORM - you can store and retrieve data having no idea about database, table and columns. 
All technical details hidden from you. Care only about your business logic.

Key features:

* **Easy syntax**: Create tables based on your classes in no time *
* **Light**: etc

Installing
----------

Install and update using <a href="https://pip.pypa.io/en/stable/getting-started/">`pip`</a>:

```Python
$ pip install -U epure
```

Install and update using <a href="https://python-poetry.org/docs/">`poetry`</a>:

```Python
$ poetry add epure
```
Connecting Epure to database
----------

```python
# import connection functions from Epure
from epure import GresDb
from epure import connect

# Classic way to connect database to epure

# Format of string to connect ('database://user:password@host:port')
GresDb('postgres://postgres:postgres@localhost:5432',
log_level=3).connect()

# Alternative way of connection

db = GresDb('postgres://postgres:postgres@localhost:32', 
# host="localhost", 
port="5432", 
# database="postgres", 
# user="postgres", 
password="postgres",
log_level=3) # log_level defines level of description of opertaions
db.connect() #  with DB written in auto-generated file epure_db.log

```


A Simple Example
----------------
##### Create example class with Epure, create instance of it and read it from DB.
```python
# save this as epure_example.py
# --------------------------------
# import epure class decorator
from epure import epure, escript
# different types hints avalible
import types
from typing import List, Dict, Tuple, Callable

# ⚠️ In order to save attributes of class to db, type hints is required! ⚠️ 

# decorate class by @epure() wrap function
@epure()
class Example:
    int_attr:int
    str_attr:str = "Hello World!"

obj = Example()

obj.int_attr = 1

obj.save()

node_id = obj.node_id # -> UUID4

res = obj.table.read(node_id=node_id) # -> list[list[epure_object]]
```

Save epure instance
----------------
```python
    in development
```

Update epure instance
----------------
```python
    @epure()
    class Example:
    int_attr:int

    ex = Example()
    ex.int_attr = 42
    ex.save()
    ex.int_attr = 60
    ex.save() # If instance of epure already has node_id attr, the next save() will be treated as update
    
    res = ex.table.read(node_id=ex.node_id)[0][0]
    res.int_attr # -> 60  
```

Supported databases
----------
Postgres: yes ✔️

Oracle: no ❌

Read from table method variations
----------------
#### 1. Read by kwargs:
Use keyword arguments to select records with specified fields
```python 
# node_id is UUID type id used to search epure objects and 
# retrive them from DB via read() method, returns list of list with object(s)
res = epure.table.read(node_id=node_id) # -> list[list[epure_object]]

# find objects with several keyword args
res = epure.table.read(int3=6, str3="str3_value") # -> list[list[epure_object(s)]]
```
#### 2. Read by lambda function:
Use python lambda function to select records with certain conditions and to use joins 
```python
# tp is table proxy of Example table cls, dbp is database proxy of all tables
# when lambda is used tp and dbp will be assumed as table proxy and db proxy of Example class
res = Example.resource.read(lambda tp, dbp: 
    [tp.float_attr, tp.range_attr, tp.epure_cls_attr, dbp['example'].node_id,
    
    dbp['example'] << (tp.epure_cls_attr == dbp['example'].node_id # "<<" is a join operator
    | tp.generic_list0 == dbp['example'].generic_list_attr) ^

    tp.str_attr == 'str3_value' 
    & (tp.int_attr > 3 | tp.float_attr < 0.8)

    ^dbp['another_table'] << tp.epure_class1 == dbp['another_table'].node_id
    ]
) # -> list[list[epure_object]]
```
#### 3. Read by @ (at/matmul) sign:
@ (at/matmul) is used in query as header query delimeter
```python
exmpl_db_proxy = Example.resource.resource_proxy['example']
an_ex_db_proxy = Example.resource.resource_proxy['another_table']

#Example A
Example.resource.read(exmpl_db_proxy @ int_attr > 12) # -> list[list[epure_objects]]

#Example B
#   exmpl_db_proxy.str_attr is a query header
Example.resource.read(exmpl_db_proxy.str_attr @ exmpl_db_proxy.str_attr == an_ex_db_proxy.str2 | exmpl_db_proxy.int1 == an_ex_db_proxy.int0 % 3 & 5 == an_ex_db_proxy.int3 | (an_ex_db_proxy.int2 > an_ex_db_proxy.int7)) # -> list[list[epure_objects]]
```
#### 4. Read by sql query:
```python
#   use your query to select epure obj from db
Example.resource.read('select * from example where int = 42') # -> list[list[epure_objects]]
```

Avalible operators in query
----------------
#### 1. equals "=="
```python
Example.resource.read(int_attr == 12)
```
#### 2. and "&"
```python
Example.resource.read(int_attr == 12 & str_attr == "cute doge")
```
#### 3. or "|"
```python
Example.resource.read(int_attr == 12 | str_attr == "cute doge")
```
#### 4. more ">" / less "<" 
```python
Example.resource.read(int_attr > 12 | float_attr < 8.31)
```
#### 5. in: gte(greater than or equals) ">=" /lte(less than or equals) "<="
##### Gte and Lte operators are used as "in" sql operator in cases when operands are:
##### One of operands is table proxy and other is a tuple or an subquery:
```python
# tuple
Example.resource.read(int_attr >= (12, 24)) # int_attr in (12, 24)

# subquery
Example.resource.read(int_attr >= (exmpl_db_proxy @ int_attr > 2)) # int_attr in subquery
```
##### In any other case >= operator functions as normal gte operator, like for int:
```python
# tuple
Example.resource.read(int_attr >= 12) # int_attr more or equals 12 
```
#### 6. like "%" (modulo)
##### % operator is used as "like" sql operator in cases when operands are:
##### If left operand is a table proxy and right op is a string
```python
Example.resource.read(exmpl_db_proxy.string_attr % '%a%') # this % will be treated as 'like' op
```
##### in any other case % will be treated like regular modulo
```python
Example.resource.read(exmpl_db_proxy.int_attr % 3) # this % will be treated as regular modulo
```
#### 7. not "!=" (ne) (in development)
```python
```
#### 8. join << / >> (bit shift) (in development)
```python
Example.resource.read(another_table_proxy << x. == y.f4 ^ x.f1 == y.f2 & 5 == x.f5 | x.f6 == y.f7)
```


Developers
-----
Nikita Umarov (Pichugin), 
Pavel Pichugin


Links
-----

-   Documentation: https://github.com/nagvalhm/epure/blob/main/README.md
-   Changes: https://github.com/nagvalhm/epure
-   PyPI Releases: https://pypi.org/project/epure/
-   Source Code: https://github.com/nagvalhm/epure
-   Issue Tracker: https://github.com/nagvalhm/epure/issues
-   Website: https://pypi.org/project/epure/
